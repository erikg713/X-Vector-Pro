import socket
import struct

class EternalBlueScanner:
    def __init__(self, target_ip):
        self.target_ip = target_ip
        self.port = 445

    def check_vulnerability(self):
        try:
            sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
            sock.settimeout(3)
            sock.connect((self.target_ip, self.port))
            # Minimal SMB negotiation packet to provoke response
            packet = bytes.fromhex("000000850ff0534d4272000000000000001801"
                                   "2800000000000000000000000000000000000000000000004000000000000000"
                                   "0c00000001000000000000000000000057002f00570049004e002d0050005200"
                                   "4b00000000000000000000000000000000000000000000000000000000000000")
            sock.send(packet)
            response = sock.recv(1024)
            sock.close()
            return b"Windows" in response or b"\x11\x03\x02\x00" in response
        except Exception as e:
            return f"Error: {str(e)}"

# Example usage
if __name__ == "__main__":
    scanner = EternalBlueScanner("192.168.1.10")
    result = scanner.check_vulnerability()
    print("Vulnerable to MS17-010 (EternalBlue):", result)
